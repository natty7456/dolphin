@{section title}
编码规范
@{end}


<div class="span8">
	<div class="post-text">

		<h4><strong>空格与格式</strong></h4>

		<p><strong>1. 缩进</strong></p>

		<p>采用2个空格缩进，而不是tab缩进。 空格在编辑器中与字符是等宽的，而tab可能因编辑器的设置不同。2个空格会让代码看起来更紧凑、明快。</p>

		<p><strong>2. 变量声明</strong></p>

		<p>永远用<code>var</code>声明变量，不加<code>var</code>时会将其变成全局变量，这样可能会意外污染上下文，或是被意外污染。 在ECMAScript 5的strict模式下，未声明的变量将会直接抛出<code>ReferenceError</code>异常。</p>

		<p>需要说明的是，每行声明都应该带上<code>var</code>，而不是只有一个<code>var</code>，示例代码如下：</p>

		<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> </span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'assert'</span><span class="pun">);</span><span class="pln">
		</span><span class="kwd">var</span><span class="pln"> fork </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'child_process'</span><span class="pun">).</span><span class="pln">fork</span><span class="pun">;</span><span class="pln">
	</span><span class="kwd">var</span><span class="pln"> net </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'net'</span><span class="pun">);</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> </span><span class="typ">EventEmitter</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'events'</span><span class="pun">).</span><span class="typ">EventEmitter</span><span class="pun">;</span></code></pre>

<p>错误示例如下所示：</p>

<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> </span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'assert'</span><span class="pun">)</span><span class="pln">
</span><span class="pun">,</span><span class="pln"> fork </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'child_process'</span><span class="pun">).</span><span class="pln">fork
</span><span class="pun">,</span><span class="pln"> net </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'net'</span><span class="pun">)</span><span class="pln">
</span><span class="pun">,</span><span class="pln"> </span><span class="typ">EventEmitter</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'events'</span><span class="pun">).</span><span class="typ">EventEmitter</span><span class="pun">;</span></code></pre>

<p><strong>3. 空格</strong></p>

<p>在操作符前后需要加空格，比如<code>+</code>、<code>-</code>、<code>*</code>、<code>%</code>、<code>=</code>等操作符前后都应该存在一个空格，示例如下：</p>

<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> foo </span><span class="pun">=</span><span class="pln"> </span><span class="str">'bar'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> baz</span><span class="pun">;</span></code></pre>

<p>错误的示例如下所示：</p>

<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> foo</span><span class="pun">=</span><span class="str">'bar'</span><span class="pun">+</span><span class="pln">baz</span><span class="pun">;</span></code></pre>

<p>此外，在小括号前后应该存在空格，如：</p>

<pre class="prettyprint"><code><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="com">// some code</span><span class="pln">
</span><span class="pun">}</span></code></pre>

<p>错误的示例如下所示：</p>

<pre class="prettyprint"><code><span class="kwd">if</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">){</span><span class="pln">
</span><span class="com">// some code</span><span class="pln">
</span><span class="pun">}</span></code></pre>

<p><strong>4. 单双引号的使用</strong></p>

<p>由于双引号在别的场景下使用较多，在Node中使用字符串时尽量使用单引号，这样无需转义，如：</p>

<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> html </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;a href="http://cnodejs.org"&gt;CNode&lt;/a&gt;'</span><span class="pun">;</span></code></pre>

<p>而在JSON中，严格的规范是要求字符串用双引号，内容中出现双引号时，需要转义。</p>

<p><strong>5. 大括号的位置</strong></p>

<p>一般情况下，大括号无需另起一行，如</p>

<pre class="prettyprint"><code><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="com">// some code</span><span class="pln">
</span><span class="pun">}</span></code></pre>

<p>错误的示例如下：</p>

<pre class="prettyprint"><code><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
</span><span class="com">// some code</span><span class="pln">
</span><span class="pun">}</span></code></pre>

<p><strong>6. 逗号</strong></p>

<p>逗号用于变量声明的分隔或是元素的分隔。如果逗号不在行结尾，前面需要一个空格。此外，逗号不允许出现在行首，比如： <code>var foo = 'hello', bar = 'world'; //</code> 或是 <code>var hello = { foo: 'hello', bar: 'world' }; //</code> 或是 <code>var world = ['hello', 'world'];</code>错误示例如下：</p>

<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> foo </span><span class="pun">=</span><span class="pln"> </span><span class="str">'hello'</span><span class="pln">
</span><span class="pun">,</span><span class="pln"> bar </span><span class="pun">=</span><span class="pln"> </span><span class="str">'world'</span><span class="pun">;</span><span class="pln">
</span><span class="com">// 或是</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> hello </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">foo</span><span class="pun">:</span><span class="pln"> </span><span class="str">'hello'</span><span class="pln">
</span><span class="pun">,</span><span class="pln"> bar</span><span class="pun">:</span><span class="pln"> </span><span class="str">'world'</span><span class="pln">
</span><span class="pun">};</span><span class="pln">
</span><span class="com">// 或是</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> world </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
</span><span class="str">'hello'</span><span class="pln">
</span><span class="pun">,</span><span class="pln"> </span><span class="str">'world'</span><span class="pln">
</span><span class="pun">];</span></code></pre>

<p><strong>7. 分号</strong></p>

<p>给表达式结尾添加分号。尽管JavaScript编译器会自动给行尾添加分号，但还是会带来一些误解，示例如下：</p>

<pre class="prettyprint"><code><span class="kwd">function</span><span class="pln"> add</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
</span><span class="kwd">return</span><span class="pln">
a </span><span class="pun">+</span><span class="pln"> b
</span><span class="pun">}</span></code></pre>

<p>将会得到<code>undefined</code>的返回值。因为自动加入分号后会变成如下的样子：</p>

<pre class="prettyprint"><code><span class="kwd">function</span><span class="pln"> add</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
a </span><span class="pun">+</span><span class="pln"> b</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>

<p>后续的<code>a + b</code>将不会执行。</p>

<p>而如下的代码：</p>

<pre class="prettyprint"><code><span class="pln">x </span><span class="pun">=</span><span class="pln"> y
</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="pun">}())</span></code></pre>

<p>执行时会得到：</p>

<pre class="prettyprint"><code><span class="pln">x </span><span class="pun">=</span><span class="pln"> y</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}())</span></code></pre>

<p>由于自动添加分号可能带来未预期的结果，所以添加上分号有助于避免误会。</p>

<h4><strong>命名规范</strong></h4>

<p>在编码过程中，命名是重头戏。好的命名可以令代码赏心悦目，带来愉悦的阅读享受，令代码具有良好的可维护性。命令的主要范畴有变量、常量、方法、类、文件、包等。</p>

<p><strong>1. 变量命名</strong></p>

<p>变量名都采用小驼峰式命名，即除了第一个单词的首字母不大写外，每个单词的首字母都大写，词与词之间没有任何符号，如：</p>

<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> adminUser </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{};</span></code></pre>

<p>错误的示例如下：</p>

<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> admin_user </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{};</span></code></pre>

<p><strong>2. 方法命名</strong></p>

<p>方法命名与变量命名一样，采用小驼峰式命名。与变量不同的是，方法名尽量采用动词或判断性词汇，如：</p>

<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> getUser </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{};</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> isAdmin </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{};</span><span class="pln">
</span><span class="typ">User</span><span class="pun">.</span><span class="pln">prototype</span><span class="pun">.</span><span class="pln">getInfo </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{};</span></code></pre>

<p>错误示例如下：</p>

<p>var get_user = function () {};
	var is_admin = function () {};
	User.prototype.get_info = function () {};</p>

	<p><strong>3. 类命名</strong></p>

	<p>类名采用大驼峰式命名，即所有单词的首字母都大写，如：</p>

	<pre class="prettyprint"><code><span class="kwd">function</span><span class="pln"> </span><span class="typ">User</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="pun">}</span></code></pre>

	<p><strong>4. 常量命名</strong></p>

	<p>作为常量时，单词的所有字母都大写，并用下划线分割，如：</p>

	<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> PINK_COLOR </span><span class="pun">=</span><span class="pln"> </span><span class="str">"pink"</span><span class="pun">;</span></code></pre>

	<p><strong>5. 文件命名</strong></p>

	<p>命名文件时，请尽量采用下划线分割单词，比如child_process.js和string_decode.js。如果你不想将文件暴露给其他用户，可以约定以下划线开头，如_linklist.js。</p>

	<p><strong>6. 包名</strong></p>

	<p>也许你有贡献模块并将其打包发布到NPM上。在包名中，尽量不要包含js或node的字样，它是重复的。包名应当适当短且有意义的，如：</p>

	<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> express </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'express'</span><span class="pun">);</span></code></pre>

	<h4><strong>比较操作</strong></h4>

	<p>在比较操作中，如果是无容忍的场景，请尽量使用<code>===</code>代替<code>==</code>，否则你会遇到下面这样不符合逻辑的结果：</p>

	<pre class="prettyprint"><code><span class="str">'0'</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> </span><span class="com">// true</span><span class="pln">
	</span><span class="str">''</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="com">// true</span><span class="pln">
</span><span class="str">'0'</span><span class="pln"> </span><span class="pun">===</span><span class="pln"> </span><span class="str">''</span><span class="pln"> </span><span class="com">// false</span></code></pre>

<p>此外，当判断容忍假值时，可以无需使用<code>===</code>或<code>==</code>。在下面的代码中，当<code>foo</code>是<code>0</code>、<code>undefined</code>、<code>null</code>、<code>false</code>、<code>''</code>时，都会进入分支：</p>

<pre class="prettyprint"><code><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">foo</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="com">// some code</span><span class="pln">
</span><span class="pun">}</span></code></pre>

<h4><strong>字面量</strong></h4>

<p>请尽量使用<code>{}</code>、<code>[]</code>代替<code>new Object()</code>、<code>new Array()</code>，不要使用<code>string</code>、<code>bool</code>、<code>number</code>对象类型，即不要调用<code>new String</code>、<code>new Boolean</code>和<code>new Number</code>。</p>

<h4><strong>作用域</strong></h4>

<p>在JavaScript中，需要注意一个关键字和一个方法，它们是<code>with</code>和<code>eval()</code>，容易引起作用域混乱。</p>

<p><strong>1. 慎用<code>with</code></strong></p>

<p>示例代码如下：</p>

<pre class="prettyprint"><code><span class="kwd">with</span><span class="pln"> </span><span class="pun">(</span><span class="pln">obj</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	foo </span><span class="pun">=</span><span class="pln"> bar</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>

<p>它的结果有可能是如下四种之一：<code>obj.foo = obj.bar;</code>、<code>obj.foo = bar;</code>、<code>foo = bar;</code>、<code>foo = obj.bar;</code>，这些结果取决于它的作用域。如果作用域链上没有导致冲突的变量存在，使用它则是安全的。但在多人合作的项目中，这并不容易保证，所以要慎用<code>with</code>。</p>

<p><strong>2. 慎用<code>eval()</code></strong></p>

<p>慎用<code>eval()</code>的原因与<code>with</code>相同。如果不影响作用域上已存在的变量，用它是安全的。另外，利用<code>eval()</code>的这个特性，也可以玩出一些好玩的特性来，比如wind.js利用它实现了流程控制。在大多数情况下，基本上轮不到<code>eval()</code>来完成特殊使命。示例代码如下：</p>

<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> obj </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	foo</span><span class="pun">:</span><span class="pln"> </span><span class="str">'hello'</span><span class="pun">,</span><span class="pln">
	bar</span><span class="pun">:</span><span class="pln"> </span><span class="str">'world'</span><span class="pln">
</span><span class="pun">};</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> key </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Math</span><span class="pun">.</span><span class="pln">round</span><span class="pun">(</span><span class="typ">Math</span><span class="pun">.</span><span class="pln">random</span><span class="pun">()</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">100</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">===</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">'foo'</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">'bar'</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">eval</span><span class="pun">(</span><span class="str">'(obj.'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> key </span><span class="pun">+</span><span class="pln"> </span><span class="str">')'</span><span class="pun">);</span></code></pre>

<p>上述代码多出现在新手中，实际只要如下一行代码即可完成：</p>

<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span><span class="pln"> obj</span><span class="pun">[</span><span class="pln">key</span><span class="pun">];</span></code></pre>

<h4><strong>数组与对象</strong></h4>

<p>在JavaScript中，数组其实也是对象，但是两者在使用时有些细节需要注意。</p>

<p><strong>1. 字面量格式</strong></p>

<p>创建对象或者数组时，注意在结尾用逗号分隔。如果分行，一行只能一个元素，示例代码如下：</p>

<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> foo </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'hello'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'world'</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> bar </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
hello</span><span class="pun">:</span><span class="pln"> </span><span class="str">'world'</span><span class="pun">,</span><span class="pln">
pretty</span><span class="pun">:</span><span class="pln"> </span><span class="str">'code'</span><span class="pln">
</span><span class="pun">};</span></code></pre>

<p>错误示例如下所示：</p>

<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> foo </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'hello'</span><span class="pun">,</span><span class="pln">
</span><span class="str">'world'</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> bar </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
hello</span><span class="pun">:</span><span class="pln"> </span><span class="str">'world'</span><span class="pun">,</span><span class="pln"> pretty</span><span class="pun">:</span><span class="pln"> </span><span class="str">'code'</span><span class="pln">
</span><span class="pun">};</span></code></pre>

<p><strong>2. <code>for in</code>循环</strong></p>

<p>使用<code>for in</code>循环时，请对对象使用，不要对数组使用，示例代码如下：</p>

<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> foo </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span><span class="pln">
	foo</span><span class="pun">[</span><span class="lit">100</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">100</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> foo</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> foo</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>

<p>在上述代码中，第一个循环只打印一次，而第二个循环则打印0~100，这并不满足预期值。</p>

<p><strong>3. 不要把数组当做对象使用</strong></p>

<p>尽管在JavaScript内部实现中可以把数组当做对象来使用，如下所示：</p>

<pre class="prettyprint"><code><span class="kwd">var</span><span class="pln"> foo </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">];</span><span class="pln">
	foo</span><span class="pun">[</span><span class="str">'hello'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'world'</span><span class="pun">;</span></code></pre>

	<p>这在<code>for in</code>迭代时，会得到所有值：</p>

	<pre class="prettyprint"><code><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> foo</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
		console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">foo</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">
	</span><span class="pun">}</span></code></pre>

	<p>也许你只是想得到<code>hello</code>而已。</p>

	<h4><strong>异步</strong></h4>

	<p>在Node中，异步使用非常广泛并且在实践过程中形成了一些约定，这是以往不曾在意的点。</p>

	<p><strong>1. 异步回调函数的第一个参数应该是错误指示</strong></p>

	<p>并不是所有回调函数都需要将第一个参数设计为错误对象。但是一旦涉及异步，将会导致<code>try catch</code>无法捕获到异步回调期的异常。将第一个参数设计为错误对象，告知调用方是一个不错的约定。示例代码如下：</p>

	<pre class="prettyprint"><code><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> data</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="pun">};</span></code></pre>

	<p>这个约定被很多流程控制库所采用。遵循这个约定，可以享受社区流程控制库带来的业务编写便利。</p>

	<p><strong>2. 执行传入的回调函数</strong></p>

	<p>在异步方法中一旦有回调函数传入，就一定要执行它，且不能多次执行。如果不执行，可能造成调用一直等待不结束，多次执行也可能会造成未期望的结果。</p>

	<h4><strong>类与模块</strong></h4>

	<p>关于如何在JavaScript中实现继承，有各种各样的方式，但在Node中我们只推荐一种，那就是类继承的方式。另外，在Node中，如果要将一个类作为一个模块，就需要在意它的导出方式。</p>

	<p><strong>1. 类继承</strong></p>

	<p>一般情况下，我们采用Node推荐的类继承方式，示例代码如下：</p>

	<pre class="prettyprint"><code><span class="kwd">function</span><span class="pln"> </span><span class="typ">Socket</span><span class="pun">(</span><span class="pln">options</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
	</span><span class="com">// ...</span><span class="pln">
	stream</span><span class="pun">.</span><span class="typ">Stream</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span><span class="pln">
</span><span class="com">// ...</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

util</span><span class="pun">.</span><span class="pln">inherits</span><span class="pun">(</span><span class="typ">Socket</span><span class="pun">,</span><span class="pln"> stream</span><span class="pun">.</span><span class="typ">Stream</span><span class="pun">);</span></code></pre>

<p><strong>2. 导出</strong></p>

<p>所有供外部调用的方法或变量均需挂载在<code>exports</code>变量上。当需要将文件当做一个类导出时，需要通过如下的方式挂载：</p>

<pre class="prettyprint"><code><span class="kwd">module</span><span class="pun">.</span><span class="pln">exprots </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Class</span><span class="pun">;</span></code></pre>

<p>而不是通过</p>

<pre class="prettyprint"><code><span class="pln">exports </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Class</span><span class="pun">;</span></code></pre>

<p>私有方法无需因为测试等原因导出给外部，所以无须挂载。</p>

<h4><strong>注解规范</strong></h4>

<p>一般情况下，我们会对每个方法编写注释，这里采用dox的推荐注释，示例如下：</p>

<pre class="prettyprint"><code><span class="com">/**
	* Queries some records
	* Examples:
	* ```
	* query('SELECT * FROM table', function (err, data) {
	* // some code
	* });
	* ```
	* @param {String} sql Queries
	* @param {Function} callback Callback
	*/</span><span class="pln">
	exports</span><span class="pun">.</span><span class="pln">query </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">sql</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="com">// ...</span><span class="pln">
</span><span class="pun">};</span></code></pre>

<p>dox的注释规范源自于JSDoc。可以通过注释生成对应的API文档。</p>